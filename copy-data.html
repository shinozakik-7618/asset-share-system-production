<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>æ‹ ç‚¹ãƒ‡ãƒ¼ã‚¿ã‚³ãƒ”ãƒ¼ãƒ„ãƒ¼ãƒ«</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <h1>æ‹ ç‚¹ãƒ‡ãƒ¼ã‚¿ã‚³ãƒ”ãƒ¼ãƒ„ãƒ¼ãƒ«</h1>
  <button onclick="copyData()" style="padding: 20px; font-size: 18px;">ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼é–‹å§‹</button>
  <div id="log" style="margin-top: 20px; font-family: monospace;"></div>

  <script>
    // é–‹ç™ºç’°å¢ƒã®è¨­å®š
    const devConfig = {
      apiKey: "AIzaSyBtD9D_755120116234",
      authDomain: "base-asset-sharing-system.firebaseapp.com",
      projectId: "base-asset-sharing-system"
    };

    // æœ¬ç•ªç’°å¢ƒã®è¨­å®š
    const prodConfig = {
      apiKey: "AIzaSyDk3cBLq7K4y61Nt0MeniXaEmfMWmLTOp0",
      authDomain: "asset-sharing-production.firebaseapp.com",
      projectId: "asset-sharing-production"
    };

    // 2ã¤ã®Firebaseã‚¢ãƒ—ãƒªã‚’åˆæœŸåŒ–
    const devApp = firebase.initializeApp(devConfig, 'dev');
    const prodApp = firebase.initializeApp(prodConfig, 'prod');

    const devDb = devApp.firestore();
    const prodDb = prodApp.firestore();

    function log(message) {
      const logDiv = document.getElementById('log');
      logDiv.innerHTML += message + '<br>';
      console.log(message);
    }

    async function copyData() {
      try {
        log('ğŸ“¤ é–‹ç™ºç’°å¢ƒã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­...');
        
        // é–‹ç™ºç’°å¢ƒã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—
        const snapshot = await devDb.collection('baseMaster').get();
        log(`âœ… ${snapshot.size}ä»¶ã®æ‹ ç‚¹ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã—ãŸ`);
        
        log('ğŸ“¥ æœ¬ç•ªç’°å¢ƒã«ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼ä¸­...');
        
        // æœ¬ç•ªç’°å¢ƒã«ã‚³ãƒ”ãƒ¼ï¼ˆ50ä»¶ãšã¤ãƒãƒƒãƒå‡¦ç†ï¼‰
        let count = 0;
        let batch = prodDb.batch();
        
        for (const doc of snapshot.docs) {
          const ref = prodDb.collection('baseMaster').doc(doc.id);
          batch.set(ref, doc.data());
          count++;
          
          // 500ä»¶ã”ã¨ã«ã‚³ãƒŸãƒƒãƒˆï¼ˆFirestoreã®åˆ¶é™ï¼‰
          if (count % 500 === 0) {
            await batch.commit();
            log(`  ${count}ä»¶ã‚³ãƒ”ãƒ¼æ¸ˆã¿...`);
            batch = prodDb.batch();
          }
        }
        
        // æ®‹ã‚Šã‚’ã‚³ãƒŸãƒƒãƒˆ
        if (count % 500 !== 0) {
          await batch.commit();
        }
        
        log(`âœ… å®Œäº†ï¼${count}ä»¶ã®æ‹ ç‚¹ãƒ‡ãƒ¼ã‚¿ã‚’æœ¬ç•ªç’°å¢ƒã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ`);
        
      } catch (error) {
        log('âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message);
        console.error(error);
      }
    }
  </script>
</body>
</html>
